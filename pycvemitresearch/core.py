#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import requests
import html_to_json

url = {
    "MITREv1":"https://cve.mitre.org/cgi-bin/cvename.cgi",
    "MITREv2":"https://cve.mitre.org/cgi-bin/cvekey.cgi"
    }

def http_get_cve(cve):
    return html_to_json.convert(requests.get(url=url["MITREv1"], params={"name":cve}, verify=True).text)

def parser_html_cve(html):
    return {
        "CVE" : html["html"][0]['div'][3]['div'][0]['table'][0]['tr'][1]['td'][0]['h2'][0]['_value'],
        "NIST" : html["html"][0]['div'][3]['div'][0]['table'][0]['tr'][1]['td'][1]['div'][0]['a'][0]['_attributes']['href'],
        "Description" : html["html"][0]['div'][3]['div'][0]['table'][0]['tr'][3]['td'][0]['_value'],
        "AssignCNA" : html["html"][0]['div'][3]['div'][0]['table'][0]['tr'][7]['th'][0]['_value'],
        "CNA" : html["html"][0]['div'][3]['div'][0]['table'][0]['tr'][8]['td'][0]['_value'],
        "Datecreated" : html["html"][0]['div'][3]['div'][0]['table'][0]['tr'][10]['td'][0]['b'][0]['_value'],
        "References" : html["html"][0]['div'][3]['div'][0]['table'][0]['tr'][4]['th'][0]['_value'],
        "Referencesinfo" : html["html"][0]['div'][3]['div'][0]['table'][0]['tr'][6]['td'][0]['ul'][0]['li'][0]['a'][0]['_attributes']['href']
    } if html["html"][0]["div"][3].get('h2', 'ERROR') == "ERROR" else html["html"][0]["div"][3]["h2"][0]["_value"]

def cveinfo(cve):
    """ cveinfo() returns a more information about the CVE"""
    return parser_html_cve(http_get_cve(cve))

def http_get_vendor(vendor):
    return html_to_json.convert(requests.get(url=url["MITREv2"], params={"keyword":vendor}, verify=True).text)

def parser_html_vendor(html):
     CVE_b = html["html"][0]['div'][3]['div'][1]['table'][0]['tr']
     for CVE_td in CVE_b:
         CVE = CVE_td['td'][0]['a'][0]['_value']
         Description = CVE_td['td'][1]['_value']
         print(f"{CVE} - {Description}")


def vendorinfo(vendor):
    """ vendorinfo() returns CVE list about the vendor"""
    return parser_html_vendor((http_get_vendor(vendor)))
